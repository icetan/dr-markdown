<!doctype html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <script type="text/javascript" src="lib/base64.js"></script>
  <script>
// Generated by CoffeeScript 1.6.3
(function() {
  var parseHash, parseState, toDict;

  toDict = function(kvps, d) {
    var k, v, _i, _len, _ref;
    if (d == null) {
      d = {};
    }
    for (_i = 0, _len = kvps.length; _i < _len; _i++) {
      _ref = kvps[_i], k = _ref[0], v = _ref[1];
      d[k] = (v != null ? v : true);
    }
    return d;
  };

  parseState = function(str) {
    var kvp;
    return toDict((function() {
      var _i, _len, _ref, _results;
      _ref = str.split(',');
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        kvp = _ref[_i];
        if (kvp !== '') {
          _results.push(kvp.split('='));
        }
      }
      return _results;
    })());
  };

  parseHash = function(hash) {
    var data, full, fullinput, index, pos, res, state, text, text64, theme, toc, type, typeText64, _ref, _ref1;
    if (hash.charAt(0) === '#') {
      hash = hash.substring(1);
    }
    if (!hash) {
      return '';
    }
    pos = hash.indexOf(';');
    if (pos === -1) {
      state = hash;
    } else {
      state = hash.substring(0, pos);
      typeText64 = hash.substring(pos + 1);
    }
    res = '#base64';
    if (typeText64 != null) {
      _ref = typeText64.split(';', 2), type = _ref[0], text64 = _ref[1];
      text = base64.decode(text64);
    }
    _ref1 = parseState(state), toc = _ref1.toc, index = _ref1.index, full = _ref1.full, fullinput = _ref1.fullinput, theme = _ref1.theme;
    data = {
      text: text || '',
      meta: {
        mode: full ? 'read' : fullinput ? 'write' : ''
      }
    };
    if (toc != null) {
      data.meta.toc = toc;
    }
    if (index != null) {
      data.meta.index = index;
    }
    if (theme != null) {
      data.meta.theme = theme;
    }
    return '#base64/' + base64.encode(JSON.stringify(data));
  };

  window.location.href = 'v1/' + parseHash(window.location.hash);

}).call(this);
</script>
</head>
<body>
</body>
</html>
